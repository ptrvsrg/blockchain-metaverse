stages:
    - build
    - test

# Сборка и тестирование C-модуля

.build-c:
    stage: build
    script:
        - cmake -B $MODULE_NAME/build -S $MODULE_NAME -DCMAKE_BUILD_TYPE=Debug
        - cmake --build $MODULE_NAME/build
    cache:
        paths:
            - $MODULE_NAME/build


.test-c:
    stage: test
    script:
        - ctest --verbose --test-dir $MODULE_NAME/build
    cache:
        paths:
            - $MODULE_NAME/build

# Сборка и тестирование C-модуля game

build-c-game:
    variables:
        MODULE_NAME: "game"
    extends: .build-c

test-c-game:
    variables:
        MODULE_NAME: "game"
    extends: .test-c

# Сборка и тестирование Java-модуля

.build-java:
    stage: build
    script:
        - mvn -f $MODULE_NAME compile
    cache:
        paths:
            - .m2/repository

.test-java:
    stage: test
    script:
        - mvn -f $MODULE_NAME test
    cache:
        paths:
            - .m2/repository

# Сборка и тестирование Java-модуля contracts

build-java-contracts:
    variables:
        MODULE_NAME: "contracts"
    extends: .build-java

test-java-contracts:
    variables:
        MODULE_NAME: "contracts"
    extends: .test-java

# Сборка и тестирование Java-модуля start-menu

build-java-start-menu:
    variables:
        MODULE_NAME: "start-menu"
    extends: .build-java

test-java-start-menu:
    variables:
        MODULE_NAME: "start-menu"
    extends: .test-java
